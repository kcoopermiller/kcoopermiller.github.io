---
import PhotosLayout from "../../layouts/PhotosLayout.astro";
import type { ImageMetadata } from "astro";

export async function getStaticPaths() {
  const albumsData = [
    {
      url: "nepal",
      title: "Nepal",
      description: "August - December 2019",
    },
  ];

  const allPhotos = import.meta.glob<{ default: ImageMetadata }>(
    "/src/assets/photos/**/*.{JPG,jpg,jpeg,JPEG,png,gif,webp}"
  );

  const albums = await Promise.all(
    albumsData.map(async (album) => {
      const photoPaths = Object.keys(allPhotos).filter((path) =>
        path.includes(`/src/assets/photos/${album.url}/`)
      );

      const albumPhotos = await Promise.all(
        photoPaths.map(async (path) => {
          const image = await allPhotos[path]();
          return {
            src: image.default,
            alt: path.split("/").pop()?.split(".")[0] || "",
          };
        })
      );

      return {
        params: { album: album.url },
        props: {
          title: album.title,
          description: album.description,
          photos: albumPhotos,
        },
      };
    })
  );

  return albums;
}

export const prerender = true;

const { title, description, photos } = Astro.props;
---

<PhotosLayout title={title} description={description} photos={photos} />
